<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üìä Dashboard</title>

<!-- Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  font-family:"Segoe UI",Arial;
  background:linear-gradient(135deg,#fdfbfb,#ebedee);
  margin:0;
  padding:16px;
}
h1,h2{color:#2c5364}

/* Floating goat */
body::before{
  content:"üêê";
  position:fixed;
  top:12px;
  right:16px;
  font-size:36px;
  animation:floatGoat 3s ease-in-out infinite;
  pointer-events:none;
}
@keyframes floatGoat{
  0%,100%{transform:translateY(0)}
  50%{transform:translateY(-10px)}
}

/* NAV */
nav{
  background:#fff;
  border-radius:14px;
  padding:12px;
  margin-bottom:16px;
  box-shadow:0 6px 18px rgba(0,0,0,.08);
  display:flex;
  gap:14px;
  flex-wrap:wrap;
}
nav a{
  text-decoration:none;
  color:#2c5364;
  font-weight:600;
  padding:8px 14px;
  border-radius:20px;
}
nav a:hover{background:#2c5364;color:#fff}

/* Loader */
.loader{
  background:#fff;
  border-radius:16px;
  padding:20px;
  box-shadow:0 8px 22px rgba(0,0,0,.08);
  margin-bottom:16px;
  display:flex;
  align-items:center;
  gap:12px;
}
.shimmer{
  height:16px;
  width:160px;
  background:linear-gradient(90deg,#eee,#ddd,#eee);
  background-size:200% 100%;
  animation:shimmer 1.2s infinite;
  border-radius:8px;
}
@keyframes shimmer{
  0%{background-position:200%}
  100%{background-position:-200%}
}

/* Grid + cards */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:16px;
}
.card{
  background:#fff;
  border-radius:16px;
  padding:18px;
  box-shadow:0 8px 22px rgba(0,0,0,.08);
  transition:.3s;
}
.card:hover{
  transform:translateY(-4px);
  box-shadow:0 14px 32px rgba(0,0,0,.12);
}
.num{
  font-size:28px;
  font-weight:bold;
}

/* Alerts */
.alert-danger{background:#ffecec}
.alert-warning{background:#fff8e1}

/* Button */
button{
  padding:10px 14px;
  border:none;
  border-radius:8px;
  font-weight:bold;
  cursor:pointer;
  background:#2c5364;
  color:#fff;
}

@media(max-width:600px){
  h1{font-size:20px}
}
  /* ================= COLOR THEME ENHANCEMENTS ================= */

/* Section headings */
h1::after{
  content:" üêêüìä";
}
h2::after{
  content:" ‚ú®";
}

/* KPI Cards Coloring */
.card:nth-child(1){border-top:4px solid #27ae60;}
.card:nth-child(2){border-top:4px solid #3498db;}
.card:nth-child(3){border-top:4px solid #e67e22;}
.card:nth-child(4){border-top:4px solid #9b59b6;}

/* Numbers gradient */
.num{
  background:linear-gradient(45deg,#2c5364,#0f2027);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}

/* Goat detail cards subtle color */
#adultMale{color:#2980b9;}
#childMale{color:#74b9ff;}
#adultFemale{color:#d63031;}
#childFemale{color:#fd79a8;}
#pregnantGoats{color:#8e44ad;}
#born30{color:#27ae60;}
#sold30{color:#f39c12;}
#dead30{color:#c0392b;}

/* Alerts emoji emphasis */
.alert-danger::before{
  content:"üö® ";
  font-size:18px;
}
.alert-warning::before{
  content:"‚ö†Ô∏è ";
  font-size:18px;
}

/* Card hover glow */
.card:hover{
  box-shadow:
    0 14px 32px rgba(44,83,100,.25),
    inset 0 0 0 1px rgba(44,83,100,.1);
}

/* Loader emoji */
.loader span::after{
  content:" üêê";
}

/* Buttons emoji */
button::after{
  content:" üîÑ";
}

/* Charts cards decoration */
canvas{
  margin-top:8px;
}

/* Nav emojis enhancement */
nav a[href*="owner"]::before{content:"üëë "; }
nav a[href*="goats"]::before{content:"üêê "; }
nav a[href*="finance"]::before{content:"üí∞ "; }
nav a[href*="reports"]::before{content:"üìë "; }

/* Mobile polish */
@media(max-width:600px){
  .card{
    padding:14px;
  }
  .num{
    font-size:24px;
  }
}

/* =========================================================
   2Ô∏è‚É£ CHART HOVER GLOW
========================================================= */
canvas {
  transition: box-shadow .4s ease, transform .4s ease;
  border-radius: 12px;
}

.card:hover canvas {
  box-shadow: 0 0 28px rgba(44,83,100,0.45);
  transform: scale(1.02);
}

/* =========================================================
   3Ô∏è‚É£ PAGE TRANSITION ANIMATION
========================================================= */
body {
  animation: pageFade 0.8s ease forwards;
}

@keyframes pageFade {
  from {
    opacity: 0;
    transform: translateY(8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Smooth nav page change feel */
nav a {
  transition: background .3s ease, color .3s ease, transform .2s ease;
}

nav a:hover {
  transform: translateY(-2px);
}

/* =========================================================
   4Ô∏è‚É£ GLASSMORPHISM CARDS
========================================================= */
.card {
  background: rgba(255,255,255,0.72);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  border: 1px solid rgba(255,255,255,0.35);
}

/* Stronger glass on hover */
.card:hover {
  background: rgba(255,255,255,0.85);
}

/* =========================================================
   EXTRA PREMIUM POLISH (SAFE)
========================================================= */

/* KPI number glow */
.num {
  text-shadow: 0 0 8px rgba(44,83,100,0.25);
}

/* Loader polish */
.loader {
  backdrop-filter: blur(6px);
}

/* Alert glow */
.alert-danger {
  box-shadow: 0 0 18px rgba(232,65,24,0.35);
}
.alert-warning {
  box-shadow: 0 0 18px rgba(251,197,49,0.35);
}

/* Mobile smoothness */
@media(max-width:600px){
  .card {
    animation: none; /* reduce load on mobile */
  }
}

</style>
</head>

<body>

<h1>üìä Dashboard</h1>

<nav>
  <a href="owner.html">üëë Owner</a>
  <a href="goats.html">üêê Goats</a>
  <a href="finance.html">üí∞ Finance</a>
  <a href="reports.html">üìë Reports</a>
</nav>

<div class="loader" id="loader">
  <div class="shimmer"></div>
  <span>Fetching live data‚Ä¶</span>
</div>

<!-- BASIC KPI -->
<div class="grid">
  <div class="card"><h3>Total Goats</h3><div class="num" id="goatCount">0</div></div>
  <div class="card"><h3>Total Income</h3><div class="num" id="income">‚Çπ0</div></div>
  <div class="card"><h3>Total Expense</h3><div class="num" id="expense">‚Çπ0</div></div>
  <div class="card"><h3>Net Profit</h3><div class="num" id="profit">‚Çπ0</div></div>
</div>

<br>

<!-- GOAT DETAILS -->
<div class="grid">
  <div class="card"><h3>Adult Males</h3><div class="num" id="adultMale">0</div></div>
  <div class="card"><h3>Child Males</h3><div class="num" id="childMale">0</div></div>
  <div class="card"><h3>Adult Females</h3><div class="num" id="adultFemale">0</div></div>
  <div class="card"><h3>Child Females</h3><div class="num" id="childFemale">0</div></div>
  <div class="card"><h3>Pregnant Goats</h3><div class="num" id="pregnantGoats">0</div></div>
</div>

<br>

<div class="grid">
  <div class="card"><h3>Born (30 days)</h3><div class="num" id="born30">0</div></div>
  <div class="card"><h3>Sold (30 days)</h3><div class="num" id="sold30">0</div></div>
  <div class="card"><h3>Dead (30 days)</h3><div class="num" id="dead30">0</div></div>
</div>

<br>

<div class="grid" id="alerts"></div>

<br>

<!-- CHARTS -->
<div class="grid">
  <div class="card"><canvas id="genderChart"></canvas></div>
  <div class="card"><canvas id="ageChart"></canvas></div>
  <div class="card"><canvas id="activityChart"></canvas></div>
</div>

<br>

<button onclick="loadDashboard()">üîÑ Refresh Data</button>
<p id="updatedAt"></p>

<script>
const db = supabase.createClient(
  "https://jrrorjoxlwqanebnchui.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Impycm9yam94bHdxYW5lYm5jaHVpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg0NDk5ODMsImV4cCI6MjA4NDAyNTk4M30.KgITXQJmA9TNw6lbHW94egKOW_gW6nPK5UViDNC5l5k"
);

function ageMonths(dob){
  if(!dob) return 0;
  const d=new Date(dob+"T00:00:00");
  const t=new Date();
  return (t.getFullYear()-d.getFullYear())*12+(t.getMonth()-d.getMonth());
}

function animate(el,val,prefix=""){
  let c=0,step=Math.max(1,val/30);
  const t=setInterval(()=>{
    c+=step;
    if(c>=val){c=val;clearInterval(t)}
    el.innerText=prefix+Math.floor(c);
  },20);
}

async function loadDashboard(){
  loader.style.display="flex";

  const { data: goats } = await db.from("goats").select("*");
  const { data: finance } = await db.from("finance").select("*");

  loader.style.display="none";

  animate(goatCount, goats.length);

  let inc=0,exp=0;
  finance.forEach(f=>{
    if(f.type==="Income") inc+=+f.amount;
    if(f.type==="Expense") exp+=+f.amount;
  });
  animate(income,inc,"‚Çπ");
  animate(expense,exp,"‚Çπ");
  animate(profit,inc-exp,"‚Çπ");

  let adultM=0,childM=0,adultF=0,childF=0,preg=0;
  let born=0,sold=0,dead=0;

  const now=new Date();
  const last30=new Date(); last30.setDate(now.getDate()-30);

  goats.forEach(g=>{
    const age=ageMonths(g.dob);

    if(g.gender==="Male") age>=6?adultM++:childM++;
    if(g.gender==="Female"){
      age>=6?adultF++:childF++;
      if(g.life_status==="Pregnant") preg++;
    }

    if(g.dob && new Date(g.dob)>=last30) born++;

    const ref=g.updated_at||g.created_at;
    if(ref && new Date(ref)>=last30){
      if(g.status==="Sold") sold++;
      if(g.status==="Dead") dead++;
    }
  });

  adultMale.innerText=adultM;
  childMale.innerText=childM;
  adultFemale.innerText=adultF;
  childFemale.innerText=childF;
  pregnantGoats.innerText=preg;
  born30.innerText=born;
  sold30.innerText=sold;
  dead30.innerText=dead;

  alerts.innerHTML="";
  if(dead/Math.max(goats.length,1)>=0.2)
    alerts.innerHTML+=`<div class="card alert-danger">üö® High death rate in last 30 days</div>`;
  if(born<=2)
    alerts.innerHTML+=`<div class="card alert-warning">‚ö†Ô∏è Low birth rate in last 30 days</div>`;

  new Chart(genderChart,{
    type:"pie",
    data:{labels:["Male","Female"],datasets:[{data:[adultM+childM,adultF+childF]}]}
  });

  new Chart(ageChart,{
    type:"bar",
    data:{labels:["Adult M","Child M","Adult F","Child F"],datasets:[{data:[adultM,childM,adultF,childF]}]}
  });

  new Chart(activityChart,{
    type:"bar",
    data:{labels:["Born","Sold","Dead"],datasets:[{data:[born,sold,dead]}]}
  });

  updatedAt.innerText="Last updated: "+new Date().toLocaleString();
}

loadDashboard();
</script>

</body>
</html>
