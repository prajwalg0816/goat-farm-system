<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Goat Farm Owner Dashboard</title>

<style>
body{margin:0;font-family:Arial;background:#f4f6f8;display:flex}
.sidebar{width:220px;background:#203a43;color:#fff;height:100vh;padding:20px}
.sidebar h2{text-align:center}
.sidebar ul{list-style:none;padding:0}
.sidebar li{background:#2c5364;padding:12px;margin:6px 0;border-radius:5px;cursor:pointer}
.sidebar li:hover{background:#3b6f82}
.main{flex:1;padding:20px}
.section{display:none}
.section.active{display:block}
.cards{display:flex;gap:15px;margin:15px 0;flex-wrap:wrap}
.card{background:#fff;padding:15px;border-radius:10px;width:180px;text-align:center}
.card span{font-size:26px;font-weight:bold}
input,select,button{padding:8px;margin:5px 0}
button{background:#2c5364;color:#fff;border:none;cursor:pointer}
button:hover{background:#203a43}
table{width:100%;background:#fff;border-collapse:collapse;margin-top:15px}
th,td{border:1px solid #ddd;padding:8px;text-align:center}
.edit{background:#ffc107;color:#000}
.delete{background:#dc3545}
img{border-radius:5px}
</style>
</head>

<body>

<div class="sidebar">
  <h2>üêê Goat Farm</h2>
  <ul>
    <li onclick="show('dashboard')">üìä Dashboard</li>
    <li onclick="show('goats')">üêê Goats</li>
    <li onclick="show('finance')">üí∞ Finance</li>
    <li onclick="logout()">üö™ Logout</li>
  </ul>
</div>

<div class="main">

<!-- DASHBOARD -->
<div id="dashboard" class="section active">
  <h1>Dashboard</h1>
  <div class="cards">
    <div class="card">Total Goats<br><span id="dTotal">0</span></div>
    <div class="card">Male Goats<br><span id="dMale">0</span></div>
    <div class="card">Female Goats<br><span id="dFemale">0</span></div>
    <div class="card">Kids<br><span id="dKids">0</span></div>
    <div class="card">Pregnant<br><span id="dPreg">0</span></div>
    <div class="card">Income<br>‚Çπ<span id="dIncome">0</span></div>
    <div class="card">Expense<br>‚Çπ<span id="dExpense">0</span></div>
    <div class="card">Profit<br>‚Çπ<span id="dProfit">0</span></div>
  </div>
</div>

<!-- GOATS -->
<div id="goats" class="section">
<h2>Add / Edit Goat</h2>

<input type="hidden" id="editGoatId">
<input id="gname" placeholder="Goat Name (optional)">
<input id="gid" placeholder="Goat ID">
<input id="breed" placeholder="Breed">

<select id="gender" onchange="checkGender()">
  <option value="">Select Gender</option>
  <option>Male</option>
  <option>Female</option>
</select>

<input type="date" id="dob">

<select id="status">
  <option>Live</option>
  <option>Dead</option>
  <option>Sold</option>
</select>

<select id="femaleStatus" style="display:none">
  <option value="">Female Status</option>
  <option>Kid</option>
  <option>Pregnant</option>
  <option>Delivered</option>
</select>

<button onclick="saveGoat()">Save Goat</button>

<table>
<thead>
<tr>
<th>ID</th><th>Name</th><th>Breed</th><th>Gender</th>
<th>DOB</th><th>Status</th><th>Life</th><th>Action</th>
</tr>
</thead>
<tbody id="goatTable"></tbody>
</table>
</div>

<!-- FINANCE -->
<div id="finance" class="section">
<h2>Finance</h2>

<input type="hidden" id="editFinId">

<select id="fType">
  <option value="income">Income</option>
  <option value="expense">Expense</option>
</select>
<input id="fCategory" placeholder="Category">
<input id="fAmount" type="number" placeholder="Amount">
<input id="fNote" placeholder="Note">
<button onclick="saveFinance()">Save</button>

<table>
<thead>
<tr><th>Type</th><th>Category</th><th>Amount</th><th>Note</th><th>Action</th></tr>
</thead>
<tbody id="financeTable"></tbody>
</table>
</div>

</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyCOSeK0RonTva_lazfZV_H22sFAzd685iY",
  authDomain:"goatfarmmanagement-d7b89.firebaseapp.com",
  projectId:"goatfarmmanagement-d7b89"
});

const db=firebase.firestore();

function show(id){
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}
function logout(){location.href="index.html"}
function checkGender(){
  femaleStatus.style.display=gender.value==="Female"?"block":"none";
}

/* ===== GOATS LIST & DASHBOARD COUNTS ===== */
db.collection("goats").onSnapshot(s=>{
  goatTable.innerHTML="";
  let total=0,male=0,female=0,kids=0,preg=0;

  s.forEach(d=>{
    const g=d.data();
    total++;
    if(g.gender==="Male") male++;
    if(g.gender==="Female") female++;
    if(g.lifeStatus==="Kid") kids++;
    if(g.lifeStatus==="Pregnant") preg++;

    goatTable.innerHTML+=`
<tr>
<td>${g.gid}</td>
<td>${g.name||""}</td>
<td>${g.breed}</td>
<td>${g.gender}</td>
<td>${g.dob||""}</td>
<td>${g.status}</td>
<td>${g.lifeStatus||"-"}</td>
<td>
<button class="edit" onclick="editGoat('${d.id}',${JSON.stringify(g).replace(/"/g,'&quot;')})">‚úèÔ∏è</button>
<button class="delete" onclick="db.collection('goats').doc('${d.id}').delete()">‚ùå</button>
</td>
</tr>`;
  });

  dTotal.innerText=total;
  dMale.innerText=male;
  dFemale.innerText=female;
  dKids.innerText=kids;
  dPreg.innerText=preg;
});

/* ===== FINANCE & DASHBOARD TOTALS ===== */
db.collection("finance").onSnapshot(s=>{
  financeTable.innerHTML="";
  let inc=0,exp=0;

  s.forEach(d=>{
    const f=d.data();
    if(f.type==="income") inc+=f.amount;
    if(f.type==="expense") exp+=f.amount;

    financeTable.innerHTML+=`
<tr>
<td>${f.type}</td>
<td>${f.category}</td>
<td>‚Çπ${f.amount}</td>
<td>${f.note||""}</td>
<td>
<button class="edit" onclick="editFinance('${d.id}',${JSON.stringify(f).replace(/"/g,'&quot;')})">‚úèÔ∏è</button>
<button class="delete" onclick="db.collection('finance').doc('${d.id}').delete()">‚ùå</button>
</td>
</tr>`;
  });

  dIncome.innerText=inc;
  dExpense.innerText=exp;
  dProfit.innerText=inc-exp;
});

/* ===== SAVE / EDIT ===== */
function editGoat(id,g){
  show('goats');
  editGoatId.value=id;
  gname.value=g.name||"";
  gid.value=g.gid;
  breed.value=g.breed;
  gender.value=g.gender;
  dob.value=g.dob||"";
  status.value=g.status;
  femaleStatus.value=g.lifeStatus||"";
  checkGender();
}
function saveGoat(){
  const data={
    name:gname.value,
    gid:gid.value,
    breed:breed.value,
    gender:gender.value,
    dob:dob.value,
    status:status.value,
    lifeStatus:gender.value==="Female"?femaleStatus.value:""
  };
  if(editGoatId.value){
    db.collection("goats").doc(editGoatId.value).update(data);
  }else{
    db.collection("goats").add(data);
  }
  editGoatId.value="";
}
function editFinance(id,f){
  show('finance');
  editFinId.value=id;
  fType.value=f.type;
  fCategory.value=f.category;
  fAmount.value=f.amount;
  fNote.value=f.note||"";
}
function saveFinance(){
  const data={
    type:fType.value,
    category:fCategory.value,
    amount:Number(fAmount.value),
    note:fNote.value
  };
  if(editFinId.value){
    db.collection("finance").doc(editFinId.value).update(data);
  }else{
    db.collection("finance").add(data);
  }
  editFinId.value="";
}
</script>

</body>
</html>
