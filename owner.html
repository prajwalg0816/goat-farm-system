<!DOCTYPE html>
<html>
<head>
<title>Owner Panel</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<h2>Owner Panel</h2>

<nav>
  <a href="dashboard.html">Dashboard</a>
  <a href="goats.html">Goats</a>
  <a href="finance.html">Finance</a>
</nav>

</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Goat Farm Owner Dashboard</title>

<style>
body{margin:0;font-family:Arial;background:#f4f6f8;display:flex}
.sidebar{width:230px;background:#203a43;color:#fff;height:100vh;padding:20px}
.sidebar h2{text-align:center}
.sidebar ul{list-style:none;padding:0}
.sidebar li{background:#2c5364;padding:12px;margin:6px 0;border-radius:5px;cursor:pointer}
.sidebar li:hover{background:#3b6f82}
.main{flex:1;padding:20px}
.section{display:none}
.section.active{display:block}
.cards{display:flex;gap:15px;margin:15px 0;flex-wrap:wrap}
.card{background:#fff;padding:15px;border-radius:10px;width:180px;text-align:center}
.card span{font-size:26px;font-weight:bold}
input,select,button{padding:8px;margin:5px 0}
button{background:#2c5364;color:#fff;border:none;cursor:pointer}
button:hover{background:#203a43}
table{width:100%;background:#fff;border-collapse:collapse;margin-top:15px}
th,td{border:1px solid #ddd;padding:8px;text-align:center}
.edit{background:#ffc107;color:#000}
.delete{background:#dc3545}
img{border-radius:5px}
</style>
</head>

<body>

<div class="sidebar">
  <h2>üêê Goat Farm</h2>
  <ul>
    <li onclick="showSection('dashboard')">üìä Dashboard</li>
    <li onclick="showSection('goats')">üêê Goats</li>
    <li onclick="showSection('finance')">üí∞ Finance</li>
    <li onclick="logout()">üö™ Logout</li>
  </ul>
</div>

<div class="main">

<!-- DASHBOARD -->
<div id="dashboard" class="section active">
  <h1>Dashboard</h1>
  <div class="cards">
    <div class="card">Total Goats<br><span id="dTotal">0</span></div>
    <div class="card">Male<br><span id="dMale">0</span></div>
    <div class="card">Female<br><span id="dFemale">0</span></div>
    <div class="card">Kids<br><span id="dKids">0</span></div>
    <div class="card">Pregnant<br><span id="dPreg">0</span></div>
    <div class="card">Income<br>‚Çπ<span id="dIncome">0</span></div>
    <div class="card">Expense<br>‚Çπ<span id="dExpense">0</span></div>
    <div class="card">Profit<br>‚Çπ<span id="dProfit">0</span></div>
  </div>
</div>

<!-- GOATS -->
<div id="goats" class="section">
<h2>Add / Edit Goat</h2>

<input type="hidden" id="editGoatId">
<input id="gname" placeholder="Goat Name (optional)">
<input id="gid" placeholder="Goat ID">
<input id="breed" placeholder="Breed">

<select id="gender" onchange="checkGender()">
  <option value="">Select Gender</option>
  <option>Male</option>
  <option>Female</option>
</select>

<label>DOB</label><br>
<input type="date" id="dob"><br>

<select id="status">
  <option>Live</option>
  <option>Dead</option>
  <option>Sold</option>
</select>

<select id="femaleStatus" style="display:none">
  <option value="">Female Life Status</option>
  <option>Kid</option>
  <option>Pregnant</option>
  <option>Delivered</option>
</select>

<label><b>Goat Image (optional)</b></label><br>
<input type="file" id="gimage" accept="image/*"><br><br>

<button onclick="saveGoat()">Save Goat</button>

<table>
<thead>
<tr>
<th>Image</th><th>ID</th><th>Name</th><th>Breed</th>
<th>Gender</th><th>DOB</th><th>Age</th>
<th>Status</th><th>Life</th><th>Action</th>
</tr>
</thead>
<tbody id="goatTable"></tbody>
</table>
</div>

<!-- FINANCE -->
<div id="finance" class="section">
<h2>Finance</h2>

<input type="hidden" id="editFinId">

<select id="fType">
  <option value="income">Income</option>
  <option value="expense">Expense</option>
</select>
<input id="fCategory" placeholder="Category">
<input id="fAmount" type="number" placeholder="Amount">
<input id="fNote" placeholder="Note">
<button onclick="saveFinance()">Save Entry</button>

<table>
<thead>
<tr>
<th>Type</th><th>Category</th><th>Amount</th><th>Note</th><th>Action</th>
</tr>
</thead>
<tbody id="financeTable"></tbody>
</table>
</div>

</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyCOSeK0RonTva_lazfZV_H22sFAzd685iY",
  authDomain:"goatfarmmanagement-d7b89.firebaseapp.com",
  projectId:"goatfarmmanagement-d7b89",
  storageBucket:"goatfarmmanagement-d7b89.appspot.com"
});

const db=firebase.firestore();
const storage=firebase.storage();

function showSection(id){
  document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}
function logout(){location.href="index.html"}
function checkGender(){
  femaleStatus.style.display=gender.value==="Female"?"block":"none";
}

// AGE CALC
function age(d){
  if(!d) return "-";
  const b=new Date(d),t=new Date();
  let y=t.getFullYear()-b.getFullYear();
  let m=t.getMonth()-b.getMonth();
  if(m<0){y--;m+=12}
  return y+"Y "+m+"M";
}

// LOAD GOATS
db.collection("goats").onSnapshot(s=>{
  goatTable.innerHTML="";
  let t=0,m=0,f=0,k=0,p=0;
  s.forEach(d=>{
    const g=d.data();t++;
    if(g.gender==="Male")m++;
    if(g.gender==="Female")f++;
    if(g.lifeStatus==="Kid")k++;
    if(g.lifeStatus==="Pregnant")p++;
    goatTable.innerHTML+=`
<tr>
<td>${g.image?`<img src="${g.image}" width="50">`:"-"}</td>
<td>${g.gid}</td><td>${g.name||""}</td><td>${g.breed}</td>
<td>${g.gender}</td><td>${g.dob||"-"}</td><td>${age(g.dob)}</td>
<td>${g.status}</td><td>${g.lifeStatus||"-"}</td>
<td>
<button class="edit" onclick="editGoat('${d.id}',${JSON.stringify(g).replace(/"/g,'&quot;')})">‚úèÔ∏è</button>
<button class="delete" onclick="db.collection('goats').doc('${d.id}').delete()">‚ùå</button>
</td></tr>`;
  });
  dTotal.innerText=t;dMale.innerText=m;dFemale.innerText=f;
  dKids.innerText=k;dPreg.innerText=p;
});

// SAVE GOAT
function editGoat(id,g){
  showSection("goats");
  editGoatId.value=id;
  gname.value=g.name||"";gid.value=g.gid;breed.value=g.breed;
  gender.value=g.gender;dob.value=g.dob||"";status.value=g.status;
  femaleStatus.value=g.lifeStatus||"";checkGender();
}
function saveGoat(){
  if(!gid.value||!breed.value||!gender.value){alert("Required fields missing");return}
  const data={name:gname.value,gid:gid.value,breed:breed.value,gender:gender.value,
    dob:dob.value,status:status.value,
    lifeStatus:gender.value==="Female"?femaleStatus.value:""};
  const file=gimage.files[0];
  if(file){
    const r=storage.ref("goats/"+Date.now()+file.name);
    r.put(file).then(s=>s.ref.getDownloadURL().then(u=>{data.image=u;store(data)}));
  }else store(data);
}
function store(data){
  editGoatId.value?
  db.collection("goats").doc(editGoatId.value).update(data):
  db.collection("goats").add(data);
  editGoatId.value="";
  gname.value=gid.value=breed.value=dob.value="";
  gender.value="";femaleStatus.value="";gimage.value="";
}

// FINANCE
db.collection("finance").onSnapshot(s=>{
  financeTable.innerHTML="";
  let inc=0,exp=0;
  s.forEach(d=>{
    const f=d.data();
    f.type==="income"?inc+=f.amount:exp+=f.amount;
    financeTable.innerHTML+=`
<tr>
<td>${f.type}</td><td>${f.category}</td><td>‚Çπ${f.amount}</td><td>${f.note||""}</td>
<td>
<button class="edit" onclick="editFin('${d.id}',${JSON.stringify(f).replace(/"/g,'&quot;')})">‚úèÔ∏è</button>
<button class="delete" onclick="db.collection('finance').doc('${d.id}').delete()">‚ùå</button>
</td></tr>`;
  });
  dIncome.innerText=inc;dExpense.innerText=exp;dProfit.innerText=inc-exp;
});
function editFin(id,f){
  showSection("finance");
  editFinId.value=id;
  fType.value=f.type;fCategory.value=f.category;
  fAmount.value=f.amount;fNote.value=f.note||"";
}
function saveFinance(){
  if(!fCategory.value||!fAmount.value)return alert("Enter details");
  const d={type:fType.value,category:fCategory.value,amount:Number(fAmount.value),note:fNote.value};
  editFinId.value?db.collection("finance").doc(editFinId.value).update(d):db.collection("finance").add(d);
  editFinId.value="";fCategory.value=fAmount.value=fNote.value="";
}
</script>

</body>
</html>
