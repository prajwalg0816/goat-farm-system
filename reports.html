<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üìë Reports</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
  font-family:"Segoe UI",Arial;
  background:linear-gradient(135deg,#fdfbfb,#ebedee);
  margin:0;
  padding:16px;
}
h1,h2{color:#2c5364}

/* Floating goat */
body::before{
  content:"üêê";
  position:fixed;
  top:12px;
  right:16px;
  font-size:36px;
  animation:floatGoat 3s ease-in-out infinite;
  pointer-events:none;
}
@keyframes floatGoat{
  0%,100%{transform:translateY(0)}
  50%{transform:translateY(-10px)}
}

/* NAV */
nav{
  background:#fff;
  border-radius:14px;
  padding:12px;
  margin-bottom:16px;
  box-shadow:0 6px 18px rgba(0,0,0,.08);
  display:flex;
  gap:14px;
  flex-wrap:wrap;
}
nav a{
  text-decoration:none;
  color:#2c5364;
  font-weight:600;
  padding:8px 14px;
  border-radius:20px;
}
nav a:hover{background:#2c5364;color:#fff}

/* CONTROLS */
.controls{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  margin-bottom:14px;
}
select,input{
  padding:8px;
  border-radius:8px;
  border:1px solid #ccc;
}
button{
  padding:10px 14px;
  border:none;
  border-radius:8px;
  font-weight:bold;
  cursor:pointer;
  background:#2c5364;
  color:#fff;
}
.pdf{background:#1d976c}

/* CARD */
.card{
  background:#fff;
  border-radius:16px;
  padding:16px;
  box-shadow:0 8px 22px rgba(0,0,0,.08);
  margin-bottom:20px;
}

/* TABLE */
.table-wrap{overflow-x:auto}
table{
  width:100%;
  min-width:900px;
  border-collapse:collapse;
}
th{
  background:#2c5364;
  color:#fff;
  padding:10px;
}
td{
  padding:8px;
  border-bottom:1px solid #eee;
  text-align:center;
}

/* PRINT */
@media print{
  nav,.no-print,body::before{display:none}
  body{background:#fff}
  .card{box-shadow:none}
}
</style>
</head>

<body>

<h1>üìë Reports</h1>

<nav class="no-print">
  <a href="owner.html">üëë Owner</a>
  <a href="dashboard.html">üìä Dashboard</a>
  <a href="goats.html">üêê Goats</a>
  <a href="finance.html">üí∞ Finance</a>
</nav>

<!-- ================= GOAT REPORT ================= -->
<div class="card" id="goatReport">
  <h2>üêê Goat Reports</h2>

  <div class="controls no-print">
    <select id="goatFilter">
      <option value="all">All Goats</option>
      <option value="adult_male">Adult Males (‚â•6 months)</option>
      <option value="child_male">Child Males (&lt;6 months)</option>
      <option value="adult_female">Adult Females (‚â•6 months)</option>
      <option value="child_female">Child Females (&lt;6 months)</option>
      <option value="pregnant">Pregnant Goats</option>
    </select>

    <input type="date" id="bornFrom">
    <input type="date" id="bornTo">

    <button onclick="loadGoats()">Apply</button>
    <button class="pdf" onclick="printGoats()">‚¨á Goat PDF</button>
  </div>

  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Breed</th>
          <th>Gender</th>
          <th>DOB</th>
          <th>Age (Months)</th>
          <th>Status</th>
          <th>Life Status</th>
        </tr>
      </thead>
      <tbody id="goatTable"></tbody>
    </table>
  </div>
</div>

<!-- ================= FINANCE REPORT ================= -->
<div class="card" id="financeReport">
  <h2>üí∞ Finance Transactions</h2>

  <div class="controls no-print">
    <input type="date" id="fromDate">
    <input type="date" id="toDate">
    <button onclick="loadFinance()">Apply</button>
    <button class="pdf" onclick="printFinance()">‚¨á Finance PDF</button>
  </div>

  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>Date</th>
          <th>Type</th>
          <th>Category</th>
          <th>Amount</th>
          <th>Note</th>
        </tr>
      </thead>
      <tbody id="financeTable"></tbody>
    </table>
  </div>
</div>

<script>
/* ================= SUPABASE ================= */
const db = supabase.createClient(
  "https://jrrorjoxlwqanebnchui.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Impycm9yam94bHdxYW5lYm5jaHVpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg0NDk5ODMsImV4cCI6MjA4NDAyNTk4M30.KgITXQJmA9TNw6lbHW94egKOW_gW6nPK5UViDNC5l5k"
);

/* ================= DISABLE FUTURE DATES ================= */
const today = new Date().toISOString().split("T")[0];
["bornFrom","bornTo","fromDate","toDate"].forEach(id=>{
  document.getElementById(id).setAttribute("max", today);
});

/* AGE */
function ageMonths(dob){
  if(!dob) return 0;
  const d=new Date(dob+"T00:00:00");
  const t=new Date();
  return (t.getFullYear()-d.getFullYear())*12+(t.getMonth()-d.getMonth());
}

/* GOATS */
async function loadGoats(){
  const filter=goatFilter.value;
  const bf=bornFrom.value||"1900-01-01";
  const bt=bornTo.value||today;

  const { data } = await db
    .from("goats")
    .select("*")
    .gte("dob",bf)
    .lte("dob",bt);

  goatTable.innerHTML="";
  data.forEach(g=>{
    const age=ageMonths(g.dob);
    let show=false;

    if(filter==="all") show=true;
    if(filter==="adult_male" && g.gender==="Male" && age>=6) show=true;
    if(filter==="child_male" && g.gender==="Male" && age<6) show=true;
    if(filter==="adult_female" && g.gender==="Female" && age>=6) show=true;
    if(filter==="child_female" && g.gender==="Female" && age<6) show=true;
    if(filter==="pregnant" && g.life_status==="Pregnant") show=true;

    if(show){
      goatTable.innerHTML+=`
<tr>
  <td>${g.goat_id}</td>
  <td>${g.breed}</td>
  <td>${g.gender}</td>
  <td>${g.dob||"-"}</td>
  <td>${age}</td>
  <td>${g.status||"Live"}</td>
  <td>${g.life_status||"-"}</td>
</tr>`;
    }
  });
}

/* FINANCE */
async function loadFinance(){
  const from=fromDate.value||"1900-01-01";
  const to=toDate.value||today;

  const { data } = await db
    .from("finance")
    .select("*")
    .gte("entry_date",from)
    .lte("entry_date",to)
    .order("entry_date",{ascending:false});

  financeTable.innerHTML="";
  data.forEach(f=>{
    financeTable.innerHTML+=`
<tr>
  <td>${f.entry_date}</td>
  <td>${f.type}</td>
  <td>${f.category}</td>
  <td>‚Çπ${f.amount}</td>
  <td>${f.note||"-"}</td>
</tr>`;
  });
}

/* PDF */
function printGoats(){
  financeReport.style.display="none";
  window.print();
  financeReport.style.display="block";
}
function printFinance(){
  goatReport.style.display="none";
  window.print();
  goatReport.style.display="block";
}

/* INIT */
loadGoats();
loadFinance();
</script>

</body>
</html>
