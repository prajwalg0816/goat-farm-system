<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Goat Management</title>

<style>
body{
  font-family:Arial;
  background:#f4f6f8;
  padding:20px
}
nav a{
  margin-right:15px;
  font-weight:bold;
}
input,select,button{
  padding:8px;
  margin:6px 0;
}
button{
  cursor:pointer;
  background:#2c5364;
  color:#fff;
  border:none;
}
table{
  width:100%;
  background:#fff;
  border-collapse:collapse;
  margin-top:20px
}
th,td{
  border:1px solid #ddd;
  padding:8px;
  text-align:center
}
img{
  border-radius:6px
}
#statusMsg{
  font-weight:bold;
  margin-top:10px
}
</style>
</head>

<body>

<nav>
  <a href="dashboard.html">Dashboard</a>
  <a href="goats.html">Goats</a>
  <a href="finance.html">Finance</a>
</nav>

<h2>üêê Add Goat</h2>

<input id="gid" placeholder="Goat ID (required)">
<br>

<input id="breed" placeholder="Breed (required)">
<br>

<select id="gender" onchange="toggleFemaleStatus()">
  <option value="">Select Gender</option>
  <option value="Male">Male</option>
  <option value="Female">Female</option>
</select>
<br>

<label>Date of Birth</label><br>
<input type="date" id="dob">
<br>

<select id="status">
  <option value="Live">Live</option>
  <option value="Dead">Dead</option>
  <option value="Sold">Sold</option>
</select>
<br>

<select id="femaleStatus" style="display:none">
  <option value="">Female Life Status</option>
  <option value="Kid">Kid</option>
  <option value="Pregnant">Pregnant</option>
  <option value="Delivered">Delivered</option>
</select>
<br>

<label>Goat Image (optional)</label><br>
<input type="file" id="gimage" accept="image/*">
<br><br>

<button onclick="saveGoat()">Save Goat</button>

<p id="statusMsg"></p>

<h2>üìã Goat List</h2>

<table>
<thead>
<tr>
  <th>Image</th>
  <th>ID</th>
  <th>Breed</th>
  <th>Gender</th>
  <th>DOB</th>
  <th>Status</th>
  <th>Life Status</th>
  <th>Delete</th>
</tr>
</thead>
<tbody id="goatTable"></tbody>
</table>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<!-- Firebase init -->
<script src="firebase.js"></script>

<script>
function toggleFemaleStatus(){
  femaleStatus.style.display =
    gender.value === "Female" ? "block" : "none";
}

/* ===== LOAD GOATS ===== */
db.collection("goats").onSnapshot(snapshot=>{
  goatTable.innerHTML = "";
  snapshot.forEach(doc=>{
    const g = doc.data();
    goatTable.innerHTML += `
<tr>
  <td>${g.image ? `<img src="${g.image}" width="60">` : "-"}</td>
  <td>${g.gid}</td>
  <td>${g.breed}</td>
  <td>${g.gender}</td>
  <td>${g.dob || "-"}</td>
  <td>${g.status}</td>
  <td>${g.lifeStatus || "-"}</td>
  <td>
    <button onclick="deleteGoat('${doc.id}')">‚ùå</button>
  </td>
</tr>`;
  });
});

/* ===== SAVE GOAT ===== */
function saveGoat(){
  const msg = document.getElementById("statusMsg");
  msg.style.color = "red";
  msg.innerText = "";

  if(!gid.value || !breed.value || !gender.value){
    msg.innerText = "Goat ID, Breed and Gender are required";
    return;
  }

  msg.style.color = "green";
  msg.innerText = "Saving goat...";

  const goatData = {
    gid: gid.value.trim(),
    breed: breed.value.trim(),
    gender: gender.value,
    dob: dob.value || "",
    status: status.value || "Live",
    lifeStatus: gender.value === "Female" ? femaleStatus.value : "",
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  };

  const file = gimage.files[0];

  if(file){
    const ref = storage.ref("goats/" + Date.now() + "_" + file.name);
    ref.put(file)
      .then(snap => snap.ref.getDownloadURL())
      .then(url => {
        goatData.image = url;
        return db.collection("goats").add(goatData);
      })
      .then(() => {
        msg.innerText = "Goat saved successfully ‚úÖ";
        clearForm();
      })
      .catch(err => {
        msg.style.color = "red";
        msg.innerText = "Error: " + err.message;
      });
  } else {
    db.collection("goats").add(goatData)
      .then(() => {
        msg.innerText = "Goat saved successfully ‚úÖ";
        clearForm();
      })
      .catch(err => {
        msg.style.color = "red";
        msg.innerText = "Error: " + err.message;
      });
  }
}

/* ===== DELETE GOAT ===== */
function deleteGoat(id){
  if(confirm("Delete this goat?")){
    db.collection("goats").doc(id).delete();
  }
}

/* ===== CLEAR FORM ===== */
function clearForm(){
  gid.value = "";
  breed.value = "";
  gender.value = "";
  dob.value = "";
  status.value = "Live";
  femaleStatus.value = "";
  femaleStatus.style.display = "none";
  gimage.value = "";
}
</script>

</body>
</html>
