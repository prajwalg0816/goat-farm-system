<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Goats - Goat Farm</title>

<style>
body{font-family:Arial;background:#f4f6f8;padding:20px}
nav a{margin-right:15px}
input,select,button{padding:8px;margin:5px 0}
button{cursor:pointer}
table{width:100%;background:#fff;border-collapse:collapse;margin-top:15px}
th,td{border:1px solid #ddd;padding:8px;text-align:center}
img{border-radius:5px}
</style>
</head>

<body>

<nav>
  <a href="dashboard.html">Dashboard</a>
  <a href="goats.html">Goats</a>
  <a href="finance.html">Finance</a>
</nav>

<h2>Add Goat</h2>

<input id="gid" placeholder="Goat ID">
<input id="breed" placeholder="Breed">

<select id="gender" onchange="checkGender()">
  <option value="">Select Gender</option>
  <option value="Male">Male</option>
  <option value="Female">Female</option>
</select>

<br><label>DOB</label><br>
<input type="date" id="dob"><br>

<select id="femaleStatus" style="display:none">
  <option value="">Female Life Status</option>
  <option value="Kid">Kid</option>
  <option value="Pregnant">Pregnant</option>
  <option value="Delivered">Delivered</option>
</select>

<br><label>Goat Image (optional)</label><br>
<input type="file" id="gimage" accept="image/*"><br><br>

<button onclick="saveGoat()">Save Goat</button>

<h2>Goat List</h2>
<table>
<thead>
<tr>
<th>Image</th>
<th>ID</th>
<th>Breed</th>
<th>Gender</th>
<th>DOB</th>
<th>Life</th>
<th>❌</th>
</tr>
</thead>
<tbody id="goatTable"></tbody>
</table>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<!-- Single init -->
<script src="firebase.js"></script>

<script>
function checkGender(){
  femaleStatus.style.display = gender.value === "Female" ? "block" : "none";
}

// LOAD GOATS
db.collection("goats")
  .orderBy("createdAt", "desc")
  .onSnapshot(snapshot => {
    goatTable.innerHTML = "";
    snapshot.forEach(doc => {
      const g = doc.data();
      goatTable.innerHTML += `
<tr>
<td>${g.image ? `<img src="${g.image}" width="50">` : "-"}</td>
<td>${g.gid}</td>
<td>${g.breed}</td>
<td>${g.gender}</td>
<td>${g.dob || "-"}</td>
<td>${g.lifeStatus || "-"}</td>
<td><button onclick="deleteGoat('${doc.id}')">❌</button></td>
</tr>`;
    });
  });

// SAVE GOAT
function saveGoat(){
  if(!gid.value || !breed.value || !gender.value){
    alert("Goat ID, Breed and Gender are required");
    return;
  }

  const goatData = {
    gid: gid.value.trim(),
    breed: breed.value.trim(),
    gender: gender.value,
    dob: dob.value || "",
    lifeStatus: gender.value === "Female" ? femaleStatus.value : "",
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  };

  const file = gimage.files[0];

  if(file){
    const ref = storage.ref("goats/" + Date.now() + "_" + file.name);
    ref.put(file)
      .then(snap => snap.ref.getDownloadURL())
      .then(url => {
        goatData.image = url;
        return db.collection("goats").add(goatData);
      })
      .then(clearForm)
      .catch(err => alert("Upload error: " + err.message));
  } else {
    db.collection("goats").add(goatData)
      .then(clearForm)
      .catch(err => alert("Save error: " + err.message));
  }
}

function deleteGoat(id){
  if(confirm("Delete this goat?")){
    db.collection("goats").doc(id).delete();
  }
}

function clearForm(){
  gid.value = "";
  breed.value = "";
  gender.value = "";
  dob.value = "";
  femaleStatus.value = "";
  femaleStatus.style.display = "none";
  gimage.value = "";
}
</script>

</body>
</html>
